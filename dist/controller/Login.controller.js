sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","../model/formatter"],function(e,t,r,o){"use strict";return e.extend("nebula.controller.Login",{formatter:o,onInit:function(){var e=this.byId("loginButton");e.setEnabled(true);this._navContainerDelegate={onBeforeShow:this.onBeforeShow,onAfterShow:this.onAfterShow,onAfterHide:this.onAfterHide};this.getView().addEventDelegate(this._navContainerDelegate,this)},onAfterShow:function(){var e=new r({busy:false,delay:0});this.getOwnerComponent().setModel(e,"appView")},onPress:function(){var e=this.byId("loginButton");e.setEnabled(false);var r=this.byId("inputUsername");var o=this.byId("inputPassword");var a=this.byId("manterConectado");var n=this.byId("labelUsername");var s=this.byId("labelPassword");var i=r.getValue();var l=o.getValue();var u=a.getSelected();r.removeStyleClass("inputError");n.removeStyleClass("labelError");o.removeStyleClass("inputError");s.removeStyleClass("labelError");if(!this._isValidUsername(i)){r.addStyleClass("inputError");n.addStyleClass("labelError");t.error("Por favor, preencha o campo de nome de usuário");e.setEnabled(true);return}else{}if(!this._isValidUsername(l)){o.addStyleClass("inputError");s.addStyleClass("labelError");t.error("Por favor, preencha o campo de senha.");e.setEnabled(true);return}this._doLogin(i,l,u)},onForgotPasswordPress:function(){var e=this.getOwnerComponent().getRouter();e.navTo("recoverRoute")},_isValidUsername:function(e){return e.length>0},_isValidPassword:function(e){var t=/^[a-zA-Z0-9]{1,}$/;return t.test(e)},onExit:function(){this.getView().removeEventDelegate(this._navContainerDelegate);this._navContainerDelegate=null},_doLogin:function(e,r,o){var a=this;var n={username:e,password:r};var s=jQuery.ajax({type:"POST",contentType:"application/json",url:"http://20.64.235.73:4004/odata/v4/admin/login",dataType:"json",data:JSON.stringify(n),async:true,success:function(e,t,r){var n=e.value;if(n){sessionStorage.setItem("authToken",n);localStorage.setItem("authToken",n);if(o)localStorage.setItem("sKeepSigned","true");sap.m.MessageToast.show("Login realizado com sucesso, você será redirecionado em breve!");var s=a.getOwnerComponent().getRouter();s.navTo("main")}else{oLoginButton.setEnabled(true);sap.m.MessageBox.error("Ocorreu um erro ao efetuar seu login. Tente novamente.")}},error:function(e,r,o){if(e.status==401){oLoginButton.setEnabled(true);t.error("Usuário ou senha incorretos.")}}})}})});
//# sourceMappingURL=Login.controller.js.map